!function(a,b){if("function"==typeof define&&define.amd)define("FldGrd",["module","exports"],b);else if("undefined"!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.FldGrd=c.exports}}(this,function(a,b){"use strict";function d(a,b){var c=[],d=null,e=null,f=null;for(d=b.split(","),a.id||(f="_temp_"+Math.random().toString(36).substr(2,10),a.setAttribute("id",f));d.length;)c.push("#"+a.id+" > "+d.pop());return e=document.querySelectorAll(c.join(", ")),f&&a.removeAttribute("id"),e}function e(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=Object(a);return Object.keys(c).forEach(function(a){void 0!==c[a]&&null!==c[a]&&Object.keys(c[a]).forEach(function(b){e[b]=c[a][b]})}),e}Object.defineProperty(b,"__esModule",{value:!0});var c={rowHeight:250,rowHeightOrphan:function(b){return Math.round(b.heightAvg)},itemSelector:"*",objSelector:"img",dataWidth:"data-fld-width",dataHeight:"data-fld-height"},f=function(b,d){if(!(b instanceof Element))throw new Error("`el` is not an element");return this.el=b,this.items=[],this._props={gutter:null,pendingResize:!1},this._bind={},this._settings=e({},c,d),this._init(),this};f.prototype={_init:function(){this._setup(),this._attachEventListeners(),this.update()},_setup:function(){var b=null,c=null,e=null,f=null,g=null,h=0;for(b=d(this.el,this._settings.itemSelector),f=b.length,g=getComputedStyle(b[0],null),this._props.gutter+=parseInt(g.marginLeft,10)||0,this._props.gutter+=parseInt(g.marginRight,10)||0,this._props.gutter+=parseInt(g.paddingLeft,10)||0,this._props.gutter+=parseInt(g.paddingRight,10)||0;h<f;h++)c=parseInt(b[h].getAttribute(this._settings.dataWidth),10),e=parseInt(b[h].getAttribute(this._settings.dataHeight),10),isNaN(c)||isNaN(e)||this.items.push({width:c,normWidth:c*(this._settings.rowHeight/e),height:e,el:b[h].querySelector(this._settings.objSelector)})},update:function(){for(var b=$(this.el).width(),c=this.items.length,d=[],e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=!1,n=0,o=0;n<c;n++)if(f+=this.items[n].normWidth,h+=this._props.gutter,m=n===c-1,f+h>=b||m){for(g=b-h,g/f>1&&m?(i=this._settings.rowHeightOrphan.call(this,{heightAvg:j/d.length,heights:d}),k=i/this._settings.rowHeight):(k=Math.min(g/f,1),i=Math.floor(k*this._settings.rowHeight)),d.push(i),j+=i,o=e;o<=n;o++)l=Math.floor(k*this.items[o].normWidth)-1,this.items[o].el.style.width=l+"px",this.items[o].el.style.height=i+"px";f=0,h=0,e=n+1}return this._props.pendingResize=!1,this},_attachEventListeners:function(){this._bind.resize=this._handleResize.bind(this),window.addEventListener("resize",this._bind.resize)},_handleResize:function(){this._props.pendingResize||(this._props.pendingResize=!0,window.requestAnimationFrame(this.update.bind(this)))},destroy:function(){window.removeEventListener("resize",this._bind.resize),this.el=this.items=this._bind=this._settings=this._handlers=null}},b.default=f,a.exports=b.default});
